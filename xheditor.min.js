(function(){var r={};r.mapLang={};r.setLang=function(e,t){if(t===undefined){t=e;e=""}if(e!==""){e+="."}var i,s;for(var a in t){s=t[a];i=e+a;if(typeof s==="string"||s instanceof Array){r.mapLang[i]=s}else{r.setLang(i,s)}}};r.getLang=function(e){var t=r.mapLang[e];if(t===undefined){t=e.replace(/{#([^{}]+)}/g,function(e,t){var i=r.mapLang[t];return i?i:t})}if(typeof t==="string"){var s=arguments;t=t.replace(/{\$(\d+)}/g,function(e,t){var i=s[parseInt(t,10)+1];return i!==undefined?i:e})}return t};window.XHEDITOR=r})();(function(e,t){if(!e.browser){function i(e){e=e.toLowerCase();var t=/(chrome)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||e.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(e)||[];return{browser:t[1]||"",version:t[2]||"0"}}var s=i(navigator.userAgent);var a={};if(s.browser){a[s.browser]=true;a.version=s.version}if(a.chrome){a.webkit=true}else if(a.webkit){a.safari=true}e.browser=a}})(jQuery);(function(XHEDITOR,$,undefined){var agent=navigator.userAgent.toLowerCase();var bMobile=/mobile/i.test(agent),browser=$.browser,browerVer=parseFloat(browser.version),isIE=browser.msie,isIE11=/trident\//i.test(agent)&&(/rv:/i.test(agent)||/Netscape/i.test(agent.appName)),isMozilla=browser.mozilla,isWebkit=browser.webkit,isOpera=browser.opera,isChrome=browser.chrome,bAir=agent.indexOf(" adobeair/")>-1;var xCount=0,bShowPanel=false,bClickCancel=true,bShowModal=false,bCheckEscInit=false;var _jPanel,_jShadow,_jCntLine,_jPanelButton;var jModal,jModalShadow,layerShadow,jOverlay,jHideSelect,onModalRemove;var editorRoot;var getLang=XHEDITOR.getLang;$("script[src*=xheditor]").each(function(){var e=this.src;if(e.match(/xheditor[^\/]*\.js/i)){editorRoot=e.replace(/[\?#].*$/,"").replace(/(^|[\/\\])[^\/]*$/,"$1");return false}});if(isIE){try{document.execCommand("BackgroundImageCache",false,true)}catch(e){}var jqueryVer=$.fn.jquery;if(jqueryVer&&jqueryVer.match(/^1\.[67]/))$.attrHooks["width"]=$.attrHooks["height"]=null}var specialKeys={27:"esc",9:"tab",32:"space",13:"enter",8:"backspace",145:"scroll",20:"capslock",144:"numlock",19:"pause",45:"insert",36:"home",46:"del",35:"end",33:"pageup",34:"pagedown",37:"left",38:"up",39:"right",40:"down",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12"};var arrAlign=[{v:"justifyleft"},{v:"justifycenter"},{v:"justifyright"},{v:"justifyfull"}];var arrList=[{v:"insertOrderedList"},{v:"insertUnorderedList"}];var htmlPastetext='<div><label for="xhePastetextValue">{#PastetextTip}</label></div><div><textarea id="xhePastetextValue" wrap="soft" spellcheck="false" style="width:300px;height:100px;" /></div><div style="text-align:right;"><input type="button" id="xheSave" value="{#dialogOk}" /></div>';var htmlLink='<div><label for="xheLinkUrl">{#link.url}</label><input type="text" id="xheLinkUrl" value="http://" class="xheText" /></div><div><label for="xheLinkTarget">{#link.target}</label><select id="xheLinkTarget"><option selected="selected" value="">{#default}</option><option value="_blank">{#link.targetBlank}</option><option value="_self">{#link.targetSelf}</option><option value="_parent">{#link.targetParent}</option></select></div><div style="display:none"><label for="xheLinkText">{#link.linkText}</label><input type="text" id="xheLinkText" value="" class="xheText" /></div><div style="text-align:right;"><input type="button" id="xheSave" value="{#dialogOk}" /></div>';var htmlAnchor='<div><label for="xheAnchorName">{#anchor.name}</label><input type="text" id="xheAnchorName" value="" class="xheText" /></div><div style="text-align:right;"><input type="button" id="xheSave" value="{#dialogOk}" /></div>';var htmlImg='<div><label for="xheImgUrl">{#img.url}</label><input type="text" id="xheImgUrl" value="http://" class="xheText" /></div><div><div><label for="xheImgAlt">{#img.alt}</label><input type="text" id="xheImgAlt" /></div><div><label for="xheImgAlign">{#img.align}</label><select id="xheImgAlign"><option selected="selected" value="">{#default}</option><option value="left">{#img.alignLeft}</option><option value="right">{#img.alignRight}</option><option value="top">{#img.alignTop}</option><option value="middle">{#img.alignMiddle}</option><option value="baseline">{#img.alignBaseline}</option><option value="bottom">{#img.alignBottom}</option></select></div><div><label for="xheImgWidth">{#img.width}</label><input type="text" id="xheImgWidth" style="width:40px;" /> <label for="xheImgHeight">{#img.height}</label><input type="text" id="xheImgHeight" style="width:40px;" /></div><div><label for="xheImgBorder">{#img.border}</label><input type="text" id="xheImgBorder" style="width:40px;" /></div><div><label for="xheImgHspace">{#img.hspace}</label><input type="text" id="xheImgHspace" style="width:40px;" /> <label for="xheImgVspace">{#img.vspace}</label><input type="text" id="xheImgVspace" style="width:40px;" /></div><div style="text-align:right;"><input type="button" id="xheSave" value="{#dialogOk}" /></div>';var htmlFlash='<div><label for="xheFlashUrl">{#flash.url}</label><input type="text" id="xheFlashUrl" value="http://" class="xheText" /></div><div><label for="xheFlashWidth">{#flash.width}</label><input type="text" id="xheFlashWidth" style="width:40px;" value="480" /> <label for="xheFlashHeight">{#flash.height}</label><input type="text" id="xheFlashHeight" style="width:40px;" value="400" /></div><div style="text-align:right;"><input type="button" id="xheSave" value="{#dialogOk}" /></div>';var htmlMedia='<div><label for="xheMediaUrl">{#media.url}</label><input type="text" id="xheMediaUrl" value="http://" class="xheText" /></div><div><label for="xheMediaWidth">{#media.width}</label><input type="text" id="xheMediaWidth" style="width:40px;" value="480" /> <label for="xheMediaHeight">{#media.height}</label><input type="text" id="xheMediaHeight" style="width:40px;" value="400" /></div><div style="text-align:right;"><input type="button" id="xheSave" value="{#dialogOk}" /></div>';var htmlTable='<div><label for="xheTableRows">{#table.rows}</label><input type="text" id="xheTableRows" style="width:40px;" value="3" /> <label for="xheTableColumns">{#table.columns}</label><input type="text" id="xheTableColumns" style="width:40px;" value="2" /></div><div><label for="xheTableHeaders">{#table.headers}</label><select id="xheTableHeaders"><option selected="selected" value="">{#none}</option><option value="row">{#table.headersRow}</option><option value="col">{#table.headersCol}</option><option value="both">{#table.headersBoth}</option></select></div><div><label for="xheTableWidth">{#table.width}</label><input type="text" id="xheTableWidth" style="width:40px;" value="200" /> <label for="xheTableHeight">{#table.height}</label><input type="text" id="xheTableHeight" style="width:40px;" value="" /></div><div><label for="xheTableBorder">{#table.border}</label><input type="text" id="xheTableBorder" style="width:40px;" value="1" /></div><div><label for="xheTableCellSpacing">{#table.cellSpacing}</label><input type="text" id="xheTableCellSpacing" style="width:40px;" value="1" /> <label for="xheTableCellPadding">{#table.cellPadding}</label><input type="text" id="xheTableCellPadding" style="width:40px;" value="1" /></div><div><label for="xheTableAlign">{#table.align}</label><select id="xheTableAlign"><option selected="selected" value="">{#default}</option><option value="left">{#table.alignLeft}</option><option value="center">{#table.alignCenter}</option><option value="right">{#table.alignRight}</option></select></div><div><label for="xheTableCaption">{#table.caption}</label><input type="text" id="xheTableCaption" /></div><div style="text-align:right;"><input type="button" id="xheSave" value="{#dialogOk}" /></div>';var htmlAbout='<div style="font:12px Arial;width:245px;word-wrap:break-word;word-break:break-all;outline:none;" role="dialog" tabindex="-1"><p><span style="font-size:20px;color:#1997DF;">xhEditor</span><br />v@VERSION (build @BUILDDATE)</p><p>{#aboutXheditor}</p><p>Copyright &copy; <a href="http://xheditor.com/" target="_blank">xhEditor.com</a>. All rights reserved.</p></div>';var itemEmots={default:{name:"{#default}",width:24,height:24,line:7,list:["smile","tongue","titter","laugh","sad","wronged","fastcry","cry","wail","mad","knock","curse","crazy","angry","ohmy","awkward","panic","shy","cute","envy","proud","struggle","quiet","shutup","doubt","despise","sleep","bye"]}};var arrTools={Cut:{t:"Cut"},Copy:{t:"Copy"},Paste:{t:"Paste"},Pastetext:{t:"Pastetext",h:isIE?0:1},Blocktag:{t:"Blocktag",h:1},Fontface:{t:"Fontface",h:1},FontSize:{t:"FontSize",h:1},Bold:{t:"Bold",s:"Ctrl+B"},Italic:{t:"Italic",s:"Ctrl+I"},Underline:{t:"Underline",s:"Ctrl+U"},Strikethrough:{t:"Strikethrough"},FontColor:{t:"FontColor",h:1},BackColor:{t:"BackColor",h:1},SelectAll:{t:"SelectAll"},Removeformat:{t:"Removeformat"},Align:{t:"Align",h:1},List:{t:"List",h:1},Outdent:{t:"Outdent"},Indent:{t:"Indent"},Link:{t:"Link",s:"Ctrl+L",h:1},Unlink:{t:"Unlink"},Anchor:{t:"Anchor",h:1},Img:{t:"Img",h:1},Flash:{t:"Flash",h:1},Media:{t:"Media",h:1},Hr:{t:"Hr"},Emot:{t:"Emot",s:"ctrl+e",h:1},Table:{t:"Table",h:1},Source:{t:"Source"},Preview:{t:"Preview"},Print:{t:"Print",s:"Ctrl+P"},Fullscreen:{t:"Fullscreen",s:"Esc"},About:{t:"About"}};var toolsThemes={mini:"Bold,Italic,Underline,Strikethrough,|,Align,List,|,Link,Img",simple:"Blocktag,Fontface,FontSize,Bold,Italic,Underline,Strikethrough,FontColor,BackColor,|,Align,List,Outdent,Indent,|,Link,Img,Emot",full:"Cut,Copy,Paste,Pastetext,|,Blocktag,Fontface,FontSize,Bold,Italic,Underline,Strikethrough,FontColor,BackColor,SelectAll,Removeformat,|,Align,List,Outdent,Indent,|,Link,Unlink,Anchor,Img,Flash,Media,Hr,Emot,Table,|,Source,Preview,Print,Fullscreen"};toolsThemes.mfull=toolsThemes.full.replace(/\|(,Align)/i,"/$1");var arrDbClick={a:"Link",img:"Img",embed:"Embed"},uploadInputname="filedata";var arrEntities={"<":"&lt;",">":"&gt;",'"':"&quot;","®":"&reg;","©":"&copy;"};var regEntities=/[<>"®©]/g;var Xheditor=function(textarea,options){var _this=this,_text=textarea,_jText=$(_text),_jForm=_jText.closest("form"),_jTools,_jArea,_win,_jWin,_doc,_jDoc;var bookmark;var bInit=false,bSource=false,bFullscreen=false,bCleanPaste=false,outerScroll,bShowBlocktag=false,sLayoutStyle="",ev=null,timer,bDisableHoverExec=false,bQuickHoverExec=false;var lastPoint=null,lastAngle=null;var editorHeight=0;var settings=_this.settings=$.extend({},XHEDITOR.settings,options);var plugins=settings.plugins,strPlugins=[];if(plugins){arrTools=$.extend({},arrTools,plugins);$.each(plugins,function(e){strPlugins.push(e)});strPlugins=strPlugins.join(",")}if(settings.tools.match(/^\s*(m?full|simple|mini)\s*$/i)){var toolsTheme=toolsThemes[$.trim(settings.tools)];if(settings.delBtns){var regex=new RegExp("(^|,)("+settings.delBtns.replace(/[\s]*,[\s]*/g,"|")+")(,|$)","ig");toolsTheme=toolsTheme.replace(regex,",");toolsTheme=toolsTheme.replace(/(^,|,$)/g,"")}settings.tools=settings.tools.match(/m?full/i)&&plugins?toolsTheme.replace("Table","Table,"+strPlugins):toolsTheme}if(!settings.tools.match(/(^|,)\s*About\s*(,|$)/i))settings.tools+=",About";settings.tools=settings.tools.split(",");if(settings.editorRoot)editorRoot=settings.editorRoot;if(bAir===false)editorRoot=getLocalUrl(editorRoot,"abs");if(settings.urlBase)settings.urlBase=getLocalUrl(settings.urlBase,"abs");var idCSS="xheCSS_"+settings.skin,idContainer="xhe"+xCount+"_container",idTools="xhe"+xCount+"_Tool",idIframeArea="xhe"+xCount+"_iframearea",idIframe="xhe"+xCount+"_iframe",idFixFFCursor="xhe"+xCount+"_fixffcursor";var headHTML="",bodyClass="",skinPath=editorRoot+"xheditor_skin/"+settings.skin+"/",arrEmots=itemEmots,urlType=settings.urlType,urlBase=settings.urlBase,emotPath=settings.emotPath,emotPath=emotPath?emotPath:editorRoot+"xheditor_emot/",selEmotGroup="";arrEmots=$.extend({},arrEmots,settings.emots);emotPath=getLocalUrl(emotPath,"rel",urlBase?urlBase:null);bShowBlocktag=settings.showBlocktag;if(bShowBlocktag)bodyClass+=" showBlocktag";var arrShortCuts=[];this.init=function(){if($("#"+idCSS).length===0)$("head").append('<link id="'+idCSS+'" rel="stylesheet" type="text/css" href="'+skinPath+'ui.css" />');var e=_jText.outerWidth(),t=_jText.outerHeight();var i=settings.width||_text.style.width||(e>10?e:0);editorHeight=settings.height||_text.style.height||(t>10?t:150);if(/^\d+(?:\.\d+)?$/.test(i)){i+="px"}if(is(editorHeight,"string"))editorHeight=editorHeight.replace(/[^\d]+/g,"");var s=settings.background||_text.style.background;var a=['<span class="xheGStart"/>'],r,l,n=/\||\//i;$.each(settings.tools,function(e,t){if(t.match(n))a.push('<span class="xheGEnd"/>');if(t==="|")a.push('<span class="xheSeparator"/>');else if(t==="/")a.push("<br />");else{r=arrTools[t];if(!r)return;if(r.c)l=r.c;else l="xheIcon xheBtn"+t;a.push('<span><a href="#" title="{#'+r.t+'}" cmd="'+t+'" class="xheButton xheEnabled" tabindex="-1" role="button"><span class="'+l+'" unselectable="on" style="font-size:0;color:transparent;text-indent:-999px;">'+r.t+"</span></a></span>");if(r.s)_this.addShortcuts(r.s,t)}if(t.match(n))a.push('<span class="xheGStart"/>')});a.push('<span class="xheGEnd"/><br />');_jText.after($('<input type="text" id="'+idFixFFCursor+'" style="position:absolute;display:none;" /><span id="'+idContainer+'" class="xhe_'+settings.skin+'" style="display:none"><table cellspacing="0" cellpadding="0" class="xheLayout" style="'+(i!="0px"?"width:"+i+";":"")+"height:"+editorHeight+'px;" role="presentation"><tr><td id="'+idTools+'" class="xheTool" unselectable="on" style="height:1px;" role="presentation"></td></tr><tr><td id="'+idIframeArea+'" class="xheIframeArea" role="presentation"><iframe frameborder="0" id="'+idIframe+'" src="javascript:;" style="width:100%;"></iframe></td></tr></table></span>'));_jTools=$("#"+idTools);_jArea=$("#"+idIframeArea);headHTML='<meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><link rel="stylesheet" href="'+skinPath+'iframe.css"/>';var o=settings.loadCSS;if(o){if(is(o,"array"))for(var h in o)headHTML+='<link rel="stylesheet" href="'+o[h]+'"/>';else{if(o.match(/\s*<style(\s+[^>]*?)?>[\s\S]+?<\/style>\s*/i))headHTML+=o;else headHTML+='<link rel="stylesheet" href="'+o+'"/>'}}var c='<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml"><head>'+headHTML+"<title>{#defaultReadTip} "+(settings.readTip?settings.readTip:"")+"</title>";if(s)c+="<style>html{background:"+s+";}</style>";c+='</head><body spellcheck="0" class="editMode'+bodyClass+'"></body></html>';_this.win=_win=$("#"+idIframe)[0].contentWindow;_jWin=$(_win);try{this.doc=_doc=_win.document;_jDoc=$(_doc);_doc.open();_doc.write(getLang(c));_doc.close();if(isIE)_doc.body.contentEditable="true";else _doc.designMode="On"}catch(e){}setTimeout(setOpts,300);_this.setSource();_win.setInterval=null;_jTools.append(getLang(a.join(""))).bind("mousedown contextmenu",returnFalse).click(function(e){var t=$(e.target).closest("a");if(t.is(".xheEnabled")){clearTimeout(timer);_jTools.find("a").attr("tabindex","-1");ev=e;_this.exec(t.attr("cmd"))}return false});_jTools.find(".xheButton").hover(function(e){var t=$(this),i=settings.hoverExecDelay;var s=lastAngle;lastAngle=null;if(i===-1||bDisableHoverExec||!t.is(".xheEnabled"))return false;if(s&&s>10){bDisableHoverExec=true;setTimeout(function(){bDisableHoverExec=false},100);return false}var a=t.attr("cmd"),r=arrTools[a].h===1;if(!r){_this.hidePanel();return false}if(bQuickHoverExec)i=0;if(i>=0)timer=setTimeout(function(){ev=e;lastPoint={x:ev.clientX,y:ev.clientY};_this.exec(a)},i)},function(e){lastPoint=null;if(timer)clearTimeout(timer)}).mousemove(function(e){if(lastPoint){var t={x:e.clientX-lastPoint.x,y:e.clientY-lastPoint.y};if(Math.abs(t.x)>1||Math.abs(t.y)>1){if(t.x>0&&t.y>0){var i=Math.round(Math.atan(t.y/t.x)/.017453293);if(lastAngle)lastAngle=(lastAngle+i)/2;else lastAngle=i}else lastAngle=null;lastPoint={x:e.clientX,y:e.clientY}}}});_jPanel=$("#xhePanel");_jShadow=$("#xheShadow");_jCntLine=$("#xheCntLine");if(_jPanel.length===0){_jPanel=$('<div id="xhePanel"></div>').mousedown(function(e){e.stopPropagation()});_jShadow=$('<div id="xheShadow"></div>');_jCntLine=$('<div id="xheCntLine"></div>');setTimeout(function(){$(document.body).append(_jPanel).append(_jShadow).append(_jCntLine)},10)}$("#"+idContainer).show();_jText.hide();_jArea.css("height",editorHeight-_jTools.outerHeight());if(isIE&browerVer<8)setTimeout(function(){_jArea.css("height",editorHeight-_jTools.outerHeight())},1);_jText.focus(_this.focus);_jForm.submit(saveResult).bind("reset",loadReset);if(settings.submitID)$("#"+settings.submitID).mousedown(saveResult);$(window).bind("unload beforeunload",saveResult).bind("resize",fixFullHeight);$(document).mousedown(clickCancelPanel);if(!bCheckEscInit){$(document).keydown(checkEsc);bCheckEscInit=true}_jWin.focus(function(){if(settings.focus)settings.focus()}).blur(function(){if(settings.blur)settings.blur()});if(isWebkit){_jWin.click(fixAppleSel)}_jDoc.mousedown(clickCancelPanel).keydown(checkShortcuts).keypress(forcePtag).dblclick(checkDblClick).bind("mousedown click",function(e){_jText.trigger(e.type)});if(isIE){_jDoc.keydown(function(e){var t=_this.getRng();if(e.which===8&&t.item){$(t.item(0)).remove();return false}});function d(e){var t=$(e.target),i;if(i=t.css("width"))t.css("width","").attr("width",i.replace(/[^0-9%]+/g,""));if(i=t.css("height"))t.css("height","").attr("height",i.replace(/[^0-9%]+/g,""))}_jDoc.bind("controlselect",function(e){e=e.target;if(!$.nodeName(e,"IMG"))return;$(e).unbind("resizeend",d).bind("resizeend",d)})}_jDoc.keydown(function(e){var t=e.which;if(e.altKey&&t>=49&&t<=57){_jTools.find("a").attr("tabindex","0");_jTools.find(".xheGStart").eq(t-49).next().find("a").focus();_doc.title="\ufeff\ufeff";return false}}).click(function(){_jTools.find("a").attr("tabindex","-1")});_jTools.keydown(function(e){var t=e.which;if(t==27){_jTools.find("a").attr("tabindex","-1");_this.focus()}else if(e.altKey&&t>=49&&t<=57){_jTools.find(".xheGStart").eq(t-49).next().find("a").focus();return false}});var u=$(_doc.documentElement);if(isOpera)u.bind("keydown",function(e){if(e.ctrlKey&&e.which===86)cleanPaste()});else u.bind(isIE?"beforepaste":"paste",cleanPaste);if(settings.disableContextmenu)u.bind("contextmenu",returnFalse);if(settings.html5Upload)u.bind("dragenter dragover",function(e){var t;if((t=e.originalEvent.dataTransfer.types)&&$.inArray("Files",t)!==-1)return false}).bind("drop",function(e){var t=e.originalEvent.dataTransfer,i;if(t&&(i=t.files)&&i.length>0){var a,l,s=["Link","Img","Flash","Media"],r=[],n;for(a in s){l=s[a];if(settings["up"+l+"Url"]&&settings["up"+l+"Url"].match(/^[^!].*/i))r.push(l+":,"+settings["up"+l+"Ext"])}if(r.length===0)return false;else n=r.join(",");function o(e){var t,i,s;for(a=0;a<e.length;a++){i=e[a].name.replace(/.+\./,"");if(t=n.match(new RegExp("(\\w+):[^:]*,"+i+"(?:,|$)","i"))){if(!s)s=t[1];else if(s!==t[1])return 2}else return 1}return s}l=o(i);if(l===1)alert(getLang("upload.extLimit",n.replace(/\w+:,/g,"")));else if(l===2)alert(getLang("upload.typeLimit"));else if(l){_this.startUpload(i,settings["up"+l+"Url"],"*",function(e){var t=[],i,s=settings.onUpload;if(s)s(e);for(var a=0,r=e.length;a<r;a++){i=e[a];url=is(i,"string")?i:i.url;if(url.substr(0,1)==="!")url=url.substr(1);t.push(url)}_this.exec(l);$("#xhe"+l+"Url").val(t.join(" "));$("#xheSave").click()})}return false}});var f=settings.shortcuts;if(f)$.each(f,function(e,t){_this.addShortcuts(e,t)});xCount++;bInit=true;if(settings.fullscreen)_this.toggleFullscreen();else if(settings.sourceMode)setTimeout(_this.toggleSource,20);var p=settings.plugins;if(p){$.each(p,function(e,t){var i=t.i;if(i!==undefined){i(_this)}})}return true};this.remove=function(){_this.hidePanel();saveResult();_jText.unbind("focus",_this.focus);_jForm.unbind("submit",saveResult).unbind("reset",loadReset);if(settings.submitID)$("#"+settings.submitID).unbind("mousedown",saveResult);$(window).unbind("unload beforeunload",saveResult).unbind("resize",fixFullHeight);$(document).unbind("mousedown",clickCancelPanel);$("#"+idContainer).remove();$("#"+idFixFFCursor).remove();_jText.show();bInit=false};this.saveBookmark=function(){if(!bSource){_this.focus();var e=_this.getRng();e=e.cloneRange?e.cloneRange():e;bookmark={top:_jWin.scrollTop(),rng:e}}};this.loadBookmark=function(){if(bSource||!bookmark)return;_this.focus();var e=bookmark.rng;if(isIE)e.select();else{var t=_this.getSel();t.removeAllRanges();t.addRange(e)}_jWin.scrollTop(bookmark.top);bookmark=null};this.focus=function(){if(!bSource)_win.focus();else $("#sourceCode",_doc).focus();if(isIE){var e=_this.getRng();if(e.parentElement&&e.parentElement().ownerDocument!==_doc)_this.setTextCursor()}return false};this.setTextCursor=function(e){var t=_this.getRng(true),i=_doc.body;if(isIE||isIE11)t.moveToElementText(i);else{var s=e?"lastChild":"firstChild";while(i.nodeType!=3&&i[s]){i=i[s]}t.selectNode(i)}t.collapse(e?false:true);if(isIE||isIE11)t.select();else{var a=_this.getSel();a.removeAllRanges();a.addRange(t)}};this.getSel=function(){return _doc.selection?_doc.selection:_win.getSelection()};this.getRng=function(e){var t,i;try{if(!e){t=_this.getSel();i=t.createRange?t.createRange():t.rangeCount>0?t.getRangeAt(0):null}if(!i)i=_doc.body.createTextRange?_doc.body.createTextRange():_doc.createRange()}catch(e){}return i};this.getParent=function(e){var t=_this.getRng(),i;if(!isIE){i=t.commonAncestorContainer;if(!t.collapsed)if(t.startContainer===t.endContainer&&t.startOffset-t.endOffset<2&&t.startContainer.hasChildNodes())i=t.startContainer.childNodes[t.startOffset]}else i=t.item?t.item(0):t.parentElement();e=e?e:"*";i=$(i);if(!i.is(e))i=$(i).closest(e);return i};this.getSelect=function(e){var t=_this.getSel(),i=_this.getRng(),s=true;if(!i||i.item)s=false;else s=!t||i.boundingWidth===0||i.collapsed;if(e==="text")return s?"":i.text||(t.toString?t.toString():"");var a;if(i.cloneContents){var r=$("<div></div>"),l;l=i.cloneContents();if(l)r.append(l);a=r.html()}else if(is(i.item))a=i.item(0).outerHTML;else if(is(i.htmlText))a=i.htmlText;else a=i.toString();if(s)a="";a=_this.processHTML(a,"read");a=_this.cleanHTML(a);a=_this.formatXHTML(a);return a};this.pasteHTML=function(e,t){if(bSource)return false;_this.focus();e=_this.processHTML(e,"write");var i=_this.getSel(),s=_this.getRng();if(t!==undefined){if(s.item){var a=s.item(0);s=_this.getRng(true);s.moveToElementText(a);s.select()}s.collapse(t)}e+="<"+(isIE?"img":"span")+' id="_xhe_temp" width="0" height="0" />';if(s.insertNode){if($(s.startContainer).closest("style,script").length>0)return false;s.deleteContents();s.insertNode(s.createContextualFragment(e))}else{if(i.type.toLowerCase()==="control"){i.clear();s=_this.getRng()}s.pasteHTML(e)}var r=$("#_xhe_temp",_doc),l=r[0];if(isIE){s.moveToElementText(l);s.select()}else{s.selectNode(l);i.removeAllRanges();i.addRange(s)}r.remove()};this.pasteText=function(e,t){if(!e)e="";e=_this.domEncode(e);e=e.replace(/\r?\n/g,"<br />");_this.pasteHTML(e,t)};this.appendHTML=function(e){if(bSource)return false;_this.focus();e=_this.processHTML(e,"write");$(_doc.body).append(e);_this.setTextCursor(true)};this.domEncode=function(e){return e.replace(regEntities,function(e){return arrEntities[e]})};this.setSource=function(e){bookmark=null;if(typeof e!=="string"&&e!=="")e=_text.value;if(bSource)$("#sourceCode",_doc).val(e);else{if(settings.beforeSetSource)e=settings.beforeSetSource(e);e=_this.cleanHTML(e);e=_this.formatXHTML(e);e=_this.processHTML(e,"write");if(isIE){_doc.body.innerHTML='<img id="_xhe_temp" width="0" height="0" />'+e;$("#_xhe_temp",_doc).remove()}else _doc.body.innerHTML=e}};this.processHTML=function(e,t){var u=' class="Apple-style-span"',p=settings.listFontsize;if(t==="write"){e=e.replace(/(<(\/?)(\w+))((?:\s+[\w\-:]+\s*=\s*(?:"[^"]*"|'[^']*'|[^>\s]+))*)\s*((\/?)>)/g,function(e,t,i,s,a,r,l){s=s.toLowerCase();if(isMozilla){if(s==="strong")s="b";else if(s==="em")s="i"}else if(isWebkit){if(s==="strong"){s="span";if(!i)a+=u+' style="font-weight: bold;"'}else if(s==="em"){s="span";if(!i)a+=u+' style="font-style: italic;"'}else if(s==="u"){s="span";if(!i)a+=u+' style="text-decoration: underline;"'}else if(s==="strike"){s="span";if(!i)a+=u+' style="text-decoration: line-through;"'}}var n,o="";if(s==="del")s="strike";else if(s==="img"){a=a.replace(/\s+emot\s*=\s*("[^"]*"|'[^']*'|[^>\s]+)/i,function(e,t){n=t.match(/^(["']?)(.*)\1/)[2];n=n.split(",");if(!n[1]){n[1]=n[0];n[0]=""}if(n[0]==="default")n[0]="";return settings.emotMark?e:""})}else if(s==="a"){if(!a.match(/ href=[^ ]/i)&&a.match(/ name=[^ ]/i))o+=" xhe-anchor";if(l)r="></a>"}else if(s==="table"&&!i){var h=a.match(/\s+border\s*=\s*("[^"]*"|'[^']*'|[^>\s]+)/i);if(!h||h[1].match(/^(["']?)\s*0\s*\1$/))o+=" xhe-border"}var c;a=a.replace(/\s+([\w\-:]+)\s*=\s*("[^"]*"|'[^']*'|[^>\s]+)/g,function(e,t,i){t=t.toLowerCase();i=i.match(/^(["']?)(.*)\1/)[2];aft="";if(isIE&&t.match(/^(disabled|checked|readonly|selected)$/)&&i.match(/^(false|0)$/i))return"";if(s==="img"&&n&&t==="src")return"";if(t.match(/^(src|href)$/)){aft=" _xhe_"+t+'="'+i+'"';if(urlBase)i=getLocalUrl(i,"abs",urlBase)}if(o&&t==="class"){i+=" "+o;o=""}if(isWebkit&&t==="style"){if(s==="span"&&i.match(/(^|;)\s*(font-family|font-size|color|background-color)\s*:\s*[^;]+\s*(;|$)/i))c=true}return" "+t+'="'+i+'"'+aft});if(n){var d=emotPath+(n[0]?n[0]:"default")+"/"+n[1]+".gif";a+=' src="'+d+'" _xhe_src="'+d+'"'}if(c)a+=u;if(o)a+=' class="'+o+'"';return"<"+i+s+a+r});if(isIE)e=e.replace(/&apos;/gi,"&#39;");if(!isWebkit){function i(e,t,i,s,a,r){var l="",n,o,h,c;n=s.match(/font-family\s*:\s*([^;"]+)/i);if(n)l+=' face="'+n[1]+'"';o=s.match(/font-size\s*:\s*([^;"]+)/i);if(o){o=o[1].toLowerCase();for(var d=0;d<p.length;d++)if(o===p[d].n||o===p[d].s){h=d+1;break}if(h){l+=' size="'+h+'"';s=s.replace(/(^|;)(\s*font-size\s*:\s*[^;"]+;?)+/gi,"$1")}}c=s.match(/(?:^|[\s;])color\s*:\s*([^;"]+)/i);if(c){var u;if(u=c[1].match(/\s*rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/i)){c[1]="#";for(var f=1;f<=3;f++){c[1]+=("0"+(u[f]-0).toString(16)).slice(-2)}}c[1]=c[1].replace(/^#([0-9a-f])([0-9a-f])([0-9a-f])$/i,"#$1$1$2$2$3$3");l+=' color="'+c[1]+'"'}s=s.replace(/(^|;)(\s*(font-family|color)\s*:\s*[^;"]+;?)+/gi,"$1");if(l!==""){if(s)l+=' style="'+s+'"';return"<font"+(i?i:"")+l+(a?a:"")+">"+r+"</font>"}else return e}e=e.replace(/<(span)(\s+[^>]*?)?\s+style\s*=\s*"((?:[^"]*?;)?\s*(?:font-family|font-size|color)\s*:[^"]*)"( [^>]*)?>(((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S])*?<\/\1>)*?<\/\1>)*?)<\/\1>/gi,i);e=e.replace(/<(span)(\s+[^>]*?)?\s+style\s*=\s*"((?:[^"]*?;)?\s*(?:font-family|font-size|color)\s*:[^"]*)"( [^>]*)?>(((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S])*?<\/\1>)*?)<\/\1>/gi,i);e=e.replace(/<(span)(\s+[^>]*?)?\s+style\s*=\s*"((?:[^"]*?;)?\s*(?:font-family|font-size|color)\s*:[^"]*)"( [^>]*)?>(((?!<\1(\s+[^>]*?)?>)[\s\S])*?)<\/\1>/gi,i)}e=e.replace(/<(td|th)(\s+[^>]*?)?>(\s|&nbsp;)*<\/\1>/gi,"<$1$2>"+(isIE?"":"<br />")+"</$1>")}else{if(isWebkit){var d=[{r:/font-weight\s*:\s*bold;?/gi,t:"strong"},{r:/font-style\s*:\s*italic;?/gi,t:"em"},{r:/text-decoration\s*:\s*underline;?/gi,t:"u"},{r:/text-decoration\s*:\s*line-through;?/gi,t:"strike"}];function s(e,t,i,s,a){var r=(i?i:"")+(s?s:"");var l=[],n=[];var o,h;for(var c=0;c<d.length;c++){o=d[c].r;h=d[c].t;r=r.replace(o,function(){l.push("<"+h+">");n.push("</"+h+">");return""})}r=r.replace(/\s+style\s*=\s*"\s*"/i,"");return(r?"<span"+r+">":"")+l.join("")+a+n.join("")+(r?"</span>":"")}for(var a=0;a<2;a++){e=e.replace(/<(span)(\s+[^>]*?)?\s+class\s*=\s*"Apple-style-span"(\s+[^>]*?)?>(((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S])*?<\/\1>)*?<\/\1>)*?)<\/\1>/gi,s);e=e.replace(/<(span)(\s+[^>]*?)?\s+class\s*=\s*"Apple-style-span"(\s+[^>]*?)?>(((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S])*?<\/\1>)*?)<\/\1>/gi,s);e=e.replace(/<(span)(\s+[^>]*?)?\s+class\s*=\s*"Apple-style-span"(\s+[^>]*?)?>(((?!<\1(\s+[^>]*?)?>)[\s\S])*?)<\/\1>/gi,s)}}e=e.replace(/(<(\w+))((?:\s+[\w\-:]+\s*=\s*(?:"[^"]*"|'[^']*'|[^>\s]+))*)\s*(\/?>)/g,function(e,t,i,s,a){i=i.toLowerCase();var r;s=s.replace(/\s+_xhe_(?:src|href)\s*=\s*("[^"]*"|'[^']*'|[^>\s]+)/i,function(e,t){r=t.match(/^(["']?)(.*)\1/)[2];return""});if(r&&urlType)r=getLocalUrl(r,urlType,urlBase);s=s.replace(/\s+([\w\-:]+)\s*=\s*("[^"]*"|'[^']*'|[^>\s]+)/g,function(e,t,i){t=t.toLowerCase();i=i.match(/^(["']?)(.*)\1/)[2].replace(/"/g,"'");if(t==="class"){if(i.match(/^["']?(apple|webkit)/i))return"";i=i.replace(/\s?xhe-[a-z]+/gi,"");if(i==="")return""}else if(t.match(/^((_xhe_|_moz_|_webkit_)|jquery\d+)/i))return"";else if(r&&t.match(/^(src|href)$/i))return" "+t+'="'+r+'"';else if(t==="style"){i=i.replace(/(^|;)\s*(font-size)\s*:\s*([a-z-]+)\s*(;|$)/i,function(e,t,i,s,a){var r,l;for(var n=0;n<p.length;n++){r=p[n];if(s===r.n){l=r.s;break}}return t+i+":"+l+a})}return" "+t+'="'+i+'"'});if(i==="img"&&!s.match(/\s+alt\s*=\s*("[^"]*"|'[^']*'|[^>\s]+)/i))s+=' alt=""';return t+s+a});e=e.replace(/(<(td|th)(?:\s+[^>]*?)?>)\s*([\s\S]*?)(<br(\s*\/)?>)?\s*<\/\2>/gi,function(e,t,i,s){return t+(s?s:"&nbsp;")+"</"+i+">"});e=e.replace(/^\s*(?:<(p|div)(?:\s+[^>]*?)?>)?\s*(<span(?:\s+[^>]*?)?>\s*<\/span>|<br(?:\s+[^>]*?)?>|&nbsp;)*\s*(?:<\/\1>)?\s*$/i,"")}e=e.replace(/(<pre(?:\s+[^>]*?)?>)([\s\S]+?)(<\/pre>)/gi,function(e,t,i,s){return t+i.replace(/<br\s*\/?>/gi,"\r\n")+s});return e};this.getSource=function(e){var t,i=settings.beforeGetSource;if(bSource){t=$("#sourceCode",_doc).val();if(!i)t=_this.formatXHTML(t,false)}else{t=_this.processHTML(_doc.body.innerHTML,"read");t=_this.cleanHTML(t);t=_this.formatXHTML(t,e);if(i)t=i(t)}_text.value=t;return t};this.cleanWord=function(e){var l=settings.cleanPaste;if(l>0&&l<3&&/mso(-|normal)|WordDocument|<table\s+[^>]*?x:str|\s+class\s*=\s*"?xl[67]\d"/i.test(e)){e=e.replace(/<!--[\s\S]*?-->|<!(--)?\[[\s\S]+?\](--)?>|<style(\s+[^>]*?)?>[\s\S]*?<\/style>/gi,"");e=e.replace(/\r?\n/gi,"");if(isIE){e=e.replace(/<v:shapetype(\s+[^>]*)?>[\s\S]*<\/v:shapetype>/gi,"");e=e.replace(/<v:shape(\s+[^>]+)?>[\s\S]*?<v:imagedata(\s+[^>]+)?>\s*<\/v:imagedata>[\s\S]*?<\/v:shape>/gi,function(e,t,i){var s;s=i.match(/\s+src\s*=\s*("[^"]+"|'[^']+'|[^>\s]+)/i);if(s){s=s[1].match(/^(["']?)(.*)\1/)[2];var a='<img src="'+editorRoot+"xheditor_skin/blank.gif"+'" _xhe_temp="true" class="wordImage"';s=t.match(/\s+style\s*=\s*("[^"]+"|'[^']+'|[^>\s]+)/i);if(s){s=s[1].match(/^(["']?)(.*)\1/)[2];a+=' style="'+s+'"'}a+=" />";return a}return""})}else{e=e.replace(/<img( [^<>]*(v:shapes|msohtmlclip)[^<>]*)\/?>/gi,function(e,t){var i,s='<img src="'+editorRoot+"xheditor_skin/blank.gif"+'" _xhe_temp="true" class="wordImage"';i=t.match(/ width\s*=\s*"([^"]+)"/i);if(i)s+=' width="'+i[1]+'"';i=t.match(/ height\s*=\s*"([^"]+)"/i);if(i)s+=' height="'+i[1]+'"';return s+" />"})}e=e.replace(/(<(\/?)([\w\-:]+))((?:\s+[\w\-:]+(?:\s*=\s*(?:"[^"]*"|'[^']*'|[^>\s]+))?)*)\s*(\/?>)/g,function(e,t,i,s,a,r){s=s.toLowerCase();if(s.match(/^(link)$/)&&a.match(/file:\/\//i)||s.match(/:/)||s==="span"&&l===2)return"";if(!i){a=a.replace(/\s([\w\-:]+)(?:\s*=\s*("[^"]*"|'[^']*'|[^>\s]+))?/gi,function(e,t,i){t=t.toLowerCase();if(/:/.test(t))return"";i=i.match(/^(["']?)(.*)\1/)[2];if(l===1){switch(s){case"p":if(t==="style"){i=i.replace(/"|&quot;/gi,"'").replace(/\s*([^:]+)\s*:\s*(.*?)(;|$)/gi,function(e,t,i){return/^(text-align)$/i.test(t)?t+":"+i+";":""}).replace(/^\s+|\s+$/g,"");return i?" "+t+'="'+i+'"':""}break;case"span":if(t==="style"){i=i.replace(/"|&quot;/gi,"'").replace(/\s*([^:]+)\s*:\s*(.*?)(;|$)/gi,function(e,t,i){return/^(color|background|font-size|font-family)$/i.test(t)?t+":"+i+";":""}).replace(/^\s+|\s+$/g,"");return i?" "+t+'="'+i+'"':""}break;case"table":if(t.match(/^(cellspacing|cellpadding|border|width)$/i))return e;break;case"td":if(t.match(/^(rowspan|colspan)$/i))return e;if(t==="style"){i=i.replace(/"|&quot;/gi,"'").replace(/\s*([^:]+)\s*:\s*(.*?)(;|$)/gi,function(e,t,i){return/^(width|height)$/i.test(t)?t+":"+i+";":""}).replace(/^\s+|\s+$/g,"");return i?" "+t+'="'+i+'"':""}break;case"a":if(t.match(/^(href)$/i))return e;break;case"font":case"img":return e}}else if(l===2){switch(s){case"td":if(t.match(/^(rowspan|colspan)$/i))return e;break;case"img":return e}}return""})}return t+a+r});for(var t=0;t<3;t++)e=e.replace(/<([^\s>]+)(\s+[^>]*)?>\s*<\/\1>/g,"");function i(e,t,i){return i}for(var t=0;t<3;t++)e=e.replace(/<(span|a)>(((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S])*?<\/\1>)*?<\/\1>)*?)<\/\1>/gi,i);for(var t=0;t<3;t++)e=e.replace(/<(span|a)>(((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S])*?<\/\1>)*?)<\/\1>/gi,i);for(var t=0;t<3;t++)e=e.replace(/<(span|a)>(((?!<\1(\s+[^>]*?)?>)[\s\S])*?)<\/\1>/gi,i);for(var t=0;t<3;t++)e=e.replace(/<font(\s+[^>]+)><font(\s+[^>]+)>/gi,function(e,t,i){return"<font"+t+i+">"});e=e.replace(/(<(\/?)(tr|td)(?:\s+[^>]+)?>)[^<>]+/gi,function(e,t,i,s){if(!i&&/^td$/i.test(s))return e;else return t})}return e};this.cleanHTML=function(e){e=e.replace(/<!?\/?(DOCTYPE|html|body|meta)(\s+[^>]*?)?>/gi,"");var i;e=e.replace(/<head(?:\s+[^>]*?)?>([\s\S]*?)<\/head>/i,function(e,t){i=t.match(/<(script|style)(\s+[^>]*?)?>[\s\S]*?<\/\1>/gi);return""});if(i)e=i.join("")+e;e=e.replace(/<\??xml(:\w+)?(\s+[^>]*?)?>([\s\S]*?<\/xml>)?/gi,"");if(!settings.internalScript)e=e.replace(/<script(\s+[^>]*?)?>[\s\S]*?<\/script>/gi,"");if(!settings.internalStyle)e=e.replace(/<style(\s+[^>]*?)?>[\s\S]*?<\/style>/gi,"");if(!settings.linkTag||!settings.inlineScript||!settings.inlineStyle)e=e.replace(/(<(\w+))((?:\s+[\w-]+\s*=\s*(?:"[^"]*"|'[^']*'|[^>\s]+))*)\s*(\/?>)/gi,function(e,t,i,s,a){if(!settings.linkTag&&i.toLowerCase()==="link")return"";if(!settings.inlineScript)s=s.replace(/\s+on(?:click|dblclick|mouse(down|up|move|over|out|enter|leave|wheel)|key(down|press|up)|change|select|submit|reset|blur|focus|load|unload)\s*=\s*("[^"]*"|'[^']*'|[^>\s]+)/gi,"");if(!settings.inlineStyle)s=s.replace(/\s+(style|class)\s*=\s*("[^"]*"|'[^']*'|[^>\s]+)/gi,"");return t+s+a});e=e.replace(/<\/(strong|b|u|strike|em|i)>((?:\s|<br\/?>|&nbsp;)*?)<\1(\s+[^>]*?)?>/gi,"$2");return e};this.formatXHTML=function(e,r){var l=C("area,base,basefont,br,col,frame,hr,img,input,isindex,link,meta,param,embed");var n=C("address,applet,blockquote,button,center,dd,dir,div,dl,dt,fieldset,form,frameset,h1,h2,h3,h4,h5,h6,hr,iframe,ins,isindex,li,map,menu,noframes,noscript,object,ol,p,pre,table,tbody,td,tfoot,th,thead,tr,ul,script");var a=C("a,abbr,acronym,applet,b,basefont,bdo,big,br,button,cite,code,del,dfn,em,font,i,iframe,img,input,ins,kbd,label,map,object,q,s,samp,script,select,small,span,strike,strong,sub,sup,textarea,tt,u,var");var o=C("colgroup,dd,dt,li,options,p,td,tfoot,th,thead,tr");var h=C("checked,compact,declare,defer,disabled,ismap,multiple,nohref,noresize,noshade,nowrap,readonly,selected");var t=C("script,style");var i={b:"strong",i:"em",s:"del",strike:"del"};var s=/<(?:\/([^\s>]+)|!([^>]*?)|([\w\-:]+)((?:"[^"]*"|'[^']*'|[^"'<>])*)\s*(\/?))>/g;var c=/\s*([\w\-:]+)(?:\s*=\s*(?:"([^"]*)"|'([^']*)'|([^\s]+)))?/g;var d=[],u=[];u.last=function(){return this[this.length-1]};var f,p,g=0,m,v,b,x;var _=-1,w="body",y,k=false;while(f=s.exec(e)){p=f.index;if(p>g){x=e.substring(g,p);if(v)b.push(x);else F(x)}g=s.lastIndex;if(m=f[1]){m=T(m);if(v&&m===v){L(b.join(""));v=null;b=null}if(!v){$(m);continue}}if(v)b.push(f[0]);else{if(m=f[3]){m=T(m);S(m,f[4],f[5]);if(t[m]){v=m;b=[]}}else if(f[2])j(f[0])}}if(e.length>g)F(e.substring(g,e.length));$();e=d.join("");d=null;function C(e){var t={},i=e.split(",");for(var s=0;s<i.length;s++)t[i[s]]=true;return t}function T(e){e=e.toLowerCase();var t=i[e];return t?t:e}function S(e,t,i){if(n[e])while(u.last()&&a[u.last()])$(u.last());if(o[e]&&u.last()===e)$(e);i=l[e]||!!i;if(!i)u.push(e);var s=Array();s.push("<"+e);t.replace(c,function(e,t){t=t.toLowerCase();var i=arguments[2]?arguments[2]:arguments[3]?arguments[3]:arguments[4]?arguments[4]:h[t]?t:"";s.push(" "+t+'="'+i.replace(/"/g,"'")+'"')});s.push((i?" /":"")+">");M(s.join(""),e,true);if(e==="pre")k=true}function $(e){if(!e)var t=0;else for(var t=u.length-1;t>=0;t--)if(u[t]===e)break;if(t>=0){for(var i=u.length-1;i>=t;i--)M("</"+u[i]+">",u[i]);u.length=t}if(e==="pre"){k=false;_--}}function F(e){M(_this.domEncode(e))}function L(e){d.push(e.replace(/^[\s\r\n]+|[\s\r\n]+$/g,""))}function j(e){d.push(e)}function M(e,t,i){if(!k)e=e.replace(/(\t*\r?\n\t*)+/g,"");if(!k&&r===true){if(e.match(/^\s*$/)){d.push(e);return}var s=n[t],a=s?t:"";if(s){if(i)_++;if(w==="")_--}else if(w)_++;if(a!==w||s)E();d.push(e);if(t==="br")E();if(s&&(l[t]||!i))_--;w=s?t:"";y=i}else d.push(e)}function E(){d.push("\r\n");if(_>0){var e=_;while(e--)d.push("\t")}}var I=settings.listFontsize;function P(e,t,i,s){if(!i)return s;var a="",r,l,n,o;i=i.replace(/ face\s*=\s*"\s*([^"]*)\s*"/i,function(e,t){if(t)a+="font-family:"+t+";";return""});i=i.replace(/ size\s*=\s*"\s*(\d+)\s*"/i,function(e,t){a+="font-size:"+I[(t>7?7:t<1?1:t)-1].s+";";return""});i=i.replace(/ color\s*=\s*"\s*([^"]*)\s*"/i,function(e,t){if(t)a+="color:"+t+";";return""});i=i.replace(/ style\s*=\s*"\s*([^"]*)\s*"/i,function(e,t){if(t)a+=t;return""});i+=' style="'+a+'"';return i?"<span"+i+">"+s+"</span>":s}e=e.replace(/<(font)(\s+[^>]*?)?>(((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S])*?<\/\1>)*?<\/\1>)*?)<\/\1>/gi,P);e=e.replace(/<(font)(\s+[^>]*?)?>(((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S])*?<\/\1>)*?)<\/\1>/gi,P);e=e.replace(/<(font)(\s+[^>]*?)?>(((?!<\1(\s+[^>]*?)?>)[\s\S])*?)<\/\1>/gi,P);e=e.replace(/^(\s*\r?\n)+|(\s*\r?\n)+$/g,"");return e};this.toggleShowBlocktag=function(e){if(bShowBlocktag===e)return;bShowBlocktag=!bShowBlocktag;var t=$(_doc.body);if(bShowBlocktag){bodyClass+=" showBlocktag";t.addClass("showBlocktag")}else{bodyClass=bodyClass.replace(" showBlocktag","");t.removeClass("showBlocktag")}};this.toggleSource=function(e){if(bSource===e)return;_jTools.find("[cmd=Source]").toggleClass("xheEnabled").toggleClass("xheActive");var t=_doc.body,i=$(t),s;var a,r='<span id="_xhe_cursor"></span>',l=0;var n="";if(!bSource){_this.pasteHTML(r,true);s=_this.getSource(true);l=s.indexOf(r);if(!isOpera)l=s.substring(0,l).replace(/\r/g,"").length;s=s.replace(/(\r?\n\s*|)<span id="_xhe_cursor"><\/span>(\s*\r?\n|)/,function(e,t,i){return t&&i?"\r\n":t+i});if(isIE)t.contentEditable="false";else _doc.designMode="Off";i.attr("scroll","no").attr("class","sourceMode").html('<textarea id="sourceCode" wrap="soft" spellcheck="false" style="width:100%;height:100%" />');a=$("#sourceCode",i).blur(_this.getSource)[0];n="WYSIWYG"}else{s=_this.getSource();i.html("").removeAttr("scroll").attr("class","editMode"+bodyClass);if(isIE)t.contentEditable="true";else _doc.designMode="On";if(isMozilla){_this._exec("inserthtml","-");$("#"+idFixFFCursor).show().focus().hide()}n="Source"}bSource=!bSource;_this.setSource(s);_this.focus();if(bSource){if(a.setSelectionRange)a.setSelectionRange(l,l);else{var o=a.createTextRange();o.move("character",l);o.select()}}else _this.setTextCursor();_jTools.find("[cmd=Source]").attr("title",getLang(n)).find("span").text(n);_jTools.find("[cmd=Source],[cmd=Preview]").toggleClass("xheEnabled");_jTools.find(".xheButton").not("[cmd=Source],[cmd=Fullscreen],[cmd=About]").toggleClass("xheEnabled").attr("aria-disabled",bSource?true:false);setTimeout(setOpts,300)};this.showPreview=function(){var e=settings.beforeSetSource,t=_this.getSource();if(e)t=e(t);var i="<html><head>"+headHTML+"<title>{#Preview}</title>"+(urlBase?'<base href="'+urlBase+'"/>':"")+"</head><body>"+t+"</body></html>";var s=window.screen,a=window.open("","xhePreview","toolbar=yes,location=no,status=yes,menubar=yes,scrollbars=yes,resizable=yes,width="+Math.round(s.width*.9)+",height="+Math.round(s.height*.8)+",left="+Math.round(s.width*.05)),r=a.document;r.open();r.write(getLang(i));r.close();a.focus()};this.toggleFullscreen=function(e){if(bFullscreen===e)return;var t=$("#"+idContainer).find(".xheLayout"),i=$("#"+idContainer),s=jQuery.browser.version,a=isIE&&(s==6||s==7);if(bFullscreen){if(a)_jText.after(i);t.attr("style",sLayoutStyle);_jArea.height(editorHeight-_jTools.outerHeight());$(window).scrollTop(outerScroll);setTimeout(function(){$(window).scrollTop(outerScroll)},10)}else{if(a)$("body").append(i);outerScroll=$(window).scrollTop();sLayoutStyle=t.attr("style");t.removeAttr("style");_jArea.height("100%");setTimeout(fixFullHeight,100)}if(isMozilla){$("#"+idFixFFCursor).show().focus().hide();setTimeout(_this.focus,1)}else if(a)_this.setTextCursor();bFullscreen=!bFullscreen;i.toggleClass("xhe_Fullscreen");$("html").toggleClass("xhe_Fullfix");_jTools.find("[cmd=Fullscreen]").toggleClass("xheActive");setTimeout(setOpts,300)};this.showMenu=function(e,t){var i=$('<div class="xheMenu"></div>'),s=e.length,a=[];$.each(e,function(e,t){if(t.s==="-"){a.push('<div class="xheMenuSeparator"></div>')}else{a.push("<a href=\"javascript:void('"+t.v+'\')" title="'+(t.t?t.t:t.s)+'" v="'+t.v+'" role="option" aria-setsize="'+s+'" aria-posinset="'+(e+1)+'" tabindex="0">'+t.s+"</a>")}});i.append(getLang(a.join("")));i.click(function(e){e=e.target;if($.nodeName(e,"DIV"))return;_this.loadBookmark();t($(e).closest("a").attr("v"));_this.hidePanel();return false}).mousedown(returnFalse);_this.saveBookmark();_this.showPanel(i)};this.showColor=function(t){var e=settings.listColors;var i=$('<div class="xheColor"></div>'),s=[],a=e.length,r=0;$.each(e,function(e,t){if(r%7===0)s.push((r>0?"</div>":"")+"<div>");s.push("<a href=\"javascript:void('"+t+'\')" xhev="'+t+'" title="'+t+'" style="background:'+t+'" role="option" aria-setsize="'+a+'" aria-posinset="'+(r+1)+'"></a>');r++});s.push("</div>");i.append(s.join(""));i.click(function(e){e=e.target;if(!$.nodeName(e,"A"))return;_this.loadBookmark();t($(e).attr("xhev"));_this.hidePanel();return false}).mousedown(returnFalse);_this.saveBookmark();_this.showPanel(i)};this.showPastetext=function(){var e=$(getLang(htmlPastetext)),t=$("#xhePastetextValue",e),i=$("#xheSave",e);i.click(function(){_this.loadBookmark();var e=t.val();if(e)_this.pasteText(e);_this.hidePanel();return false});_this.saveBookmark();_this.showDialog(e)};this.showLink=function(){var e=htmlLink,t=_jDoc.find("a[name]").not("[href]"),i=t.length>0;if(i){var s=[];t.each(function(){var e=$(this).attr("name");s.push('<option value="#'+e+'">'+e+"</option>")});e=e.replace(/(<div><label for="xheLinkTarget)/,'<div><label for="xheLinkAnchor">{#link.anchor}</label><select id="xheLinkAnchor"><option value="">{#link.anchorNone}</option>'+s.join("")+"</select></div>$1")}var a=$(getLang(e)),h=_this.getParent("a"),c=$("#xheLinkText",a),d=$("#xheLinkUrl",a),u=$("#xheLinkTarget",a),r=$("#xheSave",a),f=_this.getSelect();if(i){a.find("#xheLinkAnchor").change(function(){var e=$(this).val();if(e!="")d.val(e)})}if(h.length===1){if(!h.attr("href")){ev=null;return _this.exec("Anchor")}d.val(xheAttr(h,"href"));u.attr("value",h.attr("target"))}else if(f==="")c.val(getLang(settings.defLinkText)).closest("div").show();if(settings.upLinkUrl)_this.uploadInit(d,settings.upLinkUrl,settings.upLinkExt);r.click(function(){_this.loadBookmark();var e=d.val();if(e===""||h.length===0)_this._exec("unlink");if(e!==""&&e!=="http://"){var t=e.split(" "),i=u.val(),s=c.val();if(t.length>1){_this._exec("unlink");f=_this.getSelect();var a='<a href="xhe_tmpurl"',r,l=[];if(i!=="")a+=' target="'+i+'"';a+=">xhe_tmptext</a>";s=f!==""?f:s?s:e;for(var n=0,o=t.length;n<o;n++){e=t[n];if(typeof e=="string"&&e!==""){e=e.split("||");r=a;r=r.replace("xhe_tmpurl",e[0]);r=r.replace("xhe_tmptext",e[1]?e[1]:s);l.push(r)}}_this.pasteHTML(l.join("&nbsp;"))}else{e=t[0].split("||");if(!s)s=e[0];s=e[1]?e[1]:f!==""?"":s?s:e[0];if(h.length===0){if(s)_this.pasteHTML('<a href="#xhe_tmpurl">'+s+"</a>");else _this._exec("createlink","#xhe_tmpurl");h=$('a[href$="#xhe_tmpurl"]',_doc)}else if(s&&!isWebkit)h.text(s);xheAttr(h,"href",e[0]);if(i!=="")h.attr("target",i);else h.removeAttr("target")}}_this.hidePanel();return false});_this.saveBookmark();_this.showDialog(a)};this.showAnchor=function(){var e=$(getLang(htmlAnchor)),t=_this.getParent("a"),i=$("#xheAnchorName",e),s=$("#xheSave",e);if(t.length===1){if(t.attr("href")){ev=null;return _this.exec("Link")}i.val(t.attr("name"))}s.click(function(){_this.loadBookmark();var e=i.val();if(e){if(t.length===0)_this.pasteHTML('<a name="'+e+'"></a>');else t.attr("name",e)}else if(t.length===1)t.remove();_this.hidePanel();return false});_this.saveBookmark();_this.showDialog(e)};this.showImg=function(){var e=$(getLang(htmlImg)),p=_this.getParent("img"),g=$("#xheImgUrl",e),m=$("#xheImgAlt",e),v=$("#xheImgAlign",e),b=$("#xheImgWidth",e),x=$("#xheImgHeight",e),_=$("#xheImgBorder",e),w=$("#xheImgVspace",e),y=$("#xheImgHspace",e),t=$("#xheSave",e);if(p.length===1){g.val(xheAttr(p,"src"));m.val(p.attr("alt"));v.val(p.attr("align"));b.val(p.attr("width"));x.val(p.attr("height"));_.val(p.attr("border"));var i=p.attr("vspace"),s=p.attr("hspace");w.val(i<=0?"":i);y.val(s<=0?"":s)}if(settings.upImgUrl)_this.uploadInit(g,settings.upImgUrl,settings.upImgExt);t.click(function(){_this.loadBookmark();var e=g.val();if(e!==""&&e!=="http://"){var t=e.split(" "),i=m.val(),s=v.val(),a=b.val(),r=x.val(),l=_.val(),n=w.val(),o=y.val();if(t.length>1){var h='<img src="xhe_tmpurl"',c,d=[];if(i!=="")h+=' alt="'+i+'"';if(s!=="")h+=' align="'+s+'"';if(a!=="")h+=' width="'+a+'"';if(r!=="")h+=' height="'+r+'"';if(l!=="")h+=' border="'+l+'"';if(n!=="")h+=' vspace="'+n+'"';if(o!=="")h+=' hspace="'+o+'"';h+=" />";for(var u in t){e=t[u];if(typeof e=="string"&&e!==""){e=e.split("||");c=h;c=c.replace("xhe_tmpurl",e[0]);if(e[1])c='<a href="'+e[1]+'" target="_blank">'+c+"</a>";if(e[2]){c=c.replace(/ alt=".*"/gi," ");c=c.replace(/<img /i,'<img alt="'+decodeURIComponent(e[2])+'" ')}d.push(c)}}_this.pasteHTML(d.join("&nbsp;"))}else if(t.length===1){e=t[0];if(e!==""){e=e.split("||");if(p.length===0){_this.pasteHTML('<img src="'+e[0]+'#xhe_tmpurl" />');p=$('img[src$="#xhe_tmpurl"]',_doc)}xheAttr(p,"src",e[0]);if(e[2])i=decodeURIComponent(e[2]);if(i!=="")p.attr("alt",i);if(s!=="")p.attr("align",s);else p.removeAttr("align");if(a!=="")p.attr("width",a);else p.removeAttr("width");if(r!=="")p.attr("height",r);else p.removeAttr("height");if(l!=="")p.attr("border",l);else p.removeAttr("border");if(n!=="")p.attr("vspace",n);else p.removeAttr("vspace");if(o!=="")p.attr("hspace",o);else p.removeAttr("hspace");if(e[1]){var f=p.parent("a");if(f.length===0){p.wrap("<a></a>");f=p.parent("a")}xheAttr(f,"href",e[1]);f.attr("target","_blank")}}}}else if(p.length===1)p.remove();_this.hidePanel();return false});_this.saveBookmark();_this.showDialog(e)};this.showEmbed=function(e,t,c,d,u,i,s){var a=$(getLang(t)),f=_this.getParent('embed[type="'+c+'"],embed[classid="'+d+'"]'),p=$("#xhe"+e+"Url",a),g=$("#xhe"+e+"Width",a),m=$("#xhe"+e+"Height",a),r=$("#xheSave",a);if(i)_this.uploadInit(p,i,s);if(f.length===1){p.val(xheAttr(f,"src"));g.val(f.attr("width"));m.val(f.attr("height"))}r.click(function(){_this.loadBookmark();var e=p.val();if(e!==""&&e!=="http://"){var t=g.val(),i=m.val(),s=/^\d+%?$/;if(!s.test(t))t=412;if(!s.test(i))i=300;var a='<embed type="'+c+'" classid="'+d+'" src="xhe_tmpurl"'+u;var r=e.split(" ");if(r.length>1){var l=a+"",n,o=[];l+=' width="xhe_width" height="xhe_height" />';for(var h in r){e=r[h].split("||");n=l;n=n.replace("xhe_tmpurl",e[0]);n=n.replace("xhe_width",e[1]?e[1]:t);n=n.replace("xhe_height",e[2]?e[2]:i);if(e!=="")o.push(n)}_this.pasteHTML(o.join("&nbsp;"))}else if(r.length===1){e=r[0].split("||");if(f.length===0){_this.pasteHTML(a.replace("xhe_tmpurl",e[0]+"#xhe_tmpurl")+" />");f=$('embed[src$="#xhe_tmpurl"]',_doc)}xheAttr(f,"src",e[0]);f.attr("width",e[1]?e[1]:t);f.attr("height",e[2]?e[2]:i)}}else if(f.length===1)f.remove();_this.hidePanel();return false});_this.saveBookmark();_this.showDialog(a)};this.showEmot=function(i){var e=$('<div class="xheEmot"></div>');i=i?i:selEmotGroup?selEmotGroup:"default";var t=arrEmots[i];var s=emotPath+i+"/",a=0,r=[],l="";var n=t.width,o=t.height,h=t.line,c=t.count,d=t.list;if(c){for(var u=1;u<=c;u++){a++;r.push("<a href=\"javascript:void('"+u+'\')" style="background-image:url('+s+u+'.gif);" emot="'+i+","+u+'" xhev="" title="'+u+'" role="option">&nbsp;</a>');if(a%h===0)r.push("<br />")}}else{var f=is(d,"array");$.each(d,function(e,t){if(f){e=t;t="{#emot."+i+"."+e+"}"}a++;r.push("<a href=\"javascript:void('"+t+'\')" style="background-image:url('+s+e+'.gif);" emot="'+i+","+e+'" title="'+t+'" xhev="'+t+'" role="option">&nbsp;</a>');if(a%h===0)r.push("<br />")})}var p=h*(n+12),g=Math.ceil(a/h)*(o+12),m=p*.75;if(g<=m)m="";l=$(getLang("<style>"+(m?".xheEmot div{width:"+(p+20)+"px;height:"+m+"px;}":"")+".xheEmot div a{width:"+n+"px;height:"+o+"px;}</style><div>"+r.join("")+"</div>")).click(function(e){e=e.target;var t=$(e);if(!$.nodeName(e,"A"))return;_this.loadBookmark();_this.pasteHTML('<img emot="'+t.attr("emot")+'" alt="'+t.attr("xhev")+'">');_this.hidePanel();return false}).mousedown(returnFalse);e.append(l);var v=0,b=['<ul role="tablist">'],x;$.each(arrEmots,function(e,t){v++;b.push("<li"+(i===e?' class="cur"':"")+' role="presentation"><a href="javascript:void(\''+t.name+'\')" group="'+e+'" role="tab" tabindex="0">'+t.name+"</a></li>")});if(v>1){b.push('</ul><br style="clear:both;" />');x=$(getLang(b.join(""))).click(function(e){selEmotGroup=$(e.target).attr("group");_this.exec("Emot");return false}).mousedown(returnFalse);e.append(x)}_this.saveBookmark();_this.showPanel(e)};this.showTable=function(){var e=$(getLang(htmlTable)),f=$("#xheTableRows",e),p=$("#xheTableColumns",e),g=$("#xheTableHeaders",e),m=$("#xheTableWidth",e),v=$("#xheTableHeight",e),b=$("#xheTableBorder",e),x=$("#xheTableCellSpacing",e),_=$("#xheTableCellPadding",e),w=$("#xheTableAlign",e),y=$("#xheTableCaption",e),t=$("#xheSave",e);t.click(function(){_this.loadBookmark();var e=y.val(),t=b.val(),i=f.val(),s=p.val(),a=g.val(),r=m.val(),l=v.val(),n=x.val(),o=_.val(),h=w.val();var c,d,u="<table"+(t!==""?' border="'+t+'"':"")+(r!==""?' width="'+r+'"':"")+(l!==""?' height="'+l+'"':"")+(n!==""?' cellspacing="'+n+'"':"")+(o!==""?' cellpadding="'+o+'"':"")+(h!==""?' align="'+h+'"':"")+">";if(e!=="")u+="<caption>"+e+"</caption>";if(a==="row"||a==="both"){u+="<tr>";for(c=0;c<s;c++)u+='<th scope="col"></th>';u+="</tr>";i--}u+="<tbody>";for(c=0;c<i;c++){u+="<tr>";for(d=0;d<s;d++){if(d===0&&(a==="col"||a==="both"))u+='<th scope="row"></th>';else u+="<td></td>"}u+="</tr>"}u+="</tbody></table>";_this.pasteHTML(u);_this.hidePanel();return false});_this.saveBookmark();_this.showDialog(e)};this.showAbout=function(){var e=$(getLang(htmlAbout));e.find("p").attr("role","presentation");_this.showDialog(e,true);setTimeout(function(){e.focus()},100)};this.addShortcuts=function(e,t){e=e.toLowerCase();if(arrShortCuts[e]===undefined)arrShortCuts[e]=Array();arrShortCuts[e].push(t)};this.delShortcuts=function(e){delete arrShortCuts[e]};this.uploadInit=function(o,s,a){var e=$(getLang('<span class="xheUpload"><input type="text" style="visibility:hidden;" tabindex="-1" /><input type="button" value="'+settings.upBtnText+'" class="xheBtn" tabindex="-1" /></span>')),t=$(".xheBtn",e);var r=settings.html5Upload,i=r?settings.upMultiple:1;o.after(e);t.before(o);s=s.replace(/{editorRoot}/gi,editorRoot);if(s.substr(0,1)==="!"){t.click(function(){_this.showIframeModal("{#upload.browserTitle}",s.substr(1),h,null,null)})}else{e.append('<input type="file"'+(i>1?' multiple=""':"")+' class="xheFile" size="13" name="'+uploadInputname+'" tabindex="-1" />');var l=$(".xheFile",e),n;l.change(function(){n=[];_this.startUpload(l[0],s,a,h)});setTimeout(function(){o.closest(".xheDialog").bind("dragenter dragover",returnFalse).bind("drop",function(e){var t=e.originalEvent.dataTransfer,i;if(r&&t&&(i=t.files)&&i.length>0)_this.startUpload(i,s,a,h);return false})},10)}function h(e){if(is(e,"string"))e=[e];var t=false,i,s=e.length,a,r,l=[],n=settings.onUpload;if(n)n(e);for(i=0;i<s;i++){a=e[i];r=is(a,"string")?a:a.url;if(r.substr(0,1)==="!"){t=true;r=r.substr(1)}l.push(r)}o.val(l.join(" "));if(t)o.closest(".xheDialog").find("#xheSave").click()}};this.startUpload=function(fromFiles,toUrl,limitExt,onUploadComplete){var arrMsg=[],bHtml5Upload=settings.html5Upload,upMultiple=bHtml5Upload?settings.upMultiple:1;var upload,fileList,filename,jUploadTip=$(getLang('<div style="padding:22px 0;text-align:center;line-height:30px;">{#upload.progressTip}<br /></div>')),sLoading='<img src="'+skinPath+'img/loading.gif">';if(isOpera||!bHtml5Upload||fromFiles.nodeType&&!((fileList=fromFiles.files)&&fileList[0].name)){if(!checkFileExt(fromFiles.value,limitExt))return;jUploadTip.append(sLoading);upload=new _this.html4Upload(fromFiles,toUrl,onUploadCallback)}else{if(!fileList)fileList=fromFiles;var i,len=fileList.length;if(len>upMultiple){alert(getLang("upload.countLimit",upMultiple));return}for(i=0;i<len;i++)if(!checkFileExt(fileList[i].name,limitExt))return;var jProgress=$('<div class="xheProgress"><div><span>0%</span></div></div>');jUploadTip.append(jProgress);upload=new _this.html5Upload(uploadInputname,fileList,toUrl,onUploadCallback,function(e){if(e.loaded>=0){var t=Math.round(e.loaded*100/e.total)+"%";$("div",jProgress).css("width",t);$("span",jProgress).text(t+" ( "+formatBytes(e.loaded)+" / "+formatBytes(e.total)+" )")}else jProgress.replaceWith(sLoading)})}_this.showModal("{#upload.progressTitle}",jUploadTip,320,150);upload.start();function onUploadCallback(sText,bFinish){var data=Object,bOK=false;try{data=eval("("+sText+")")}catch(e){}if(data.err===undefined||data.msg===undefined)alert(getLang("upload.apiError",toUrl,sText));else{if(data.err)alert(data.err);else{arrMsg.push(data.msg);bOK=true}}if(!bOK||bFinish)_this.removeModal();if(bFinish&&bOK)onUploadComplete(arrMsg);return bOK}};this.html4Upload=function(e,t,i){var s=(new Date).getTime(),a="jUploadFrame"+s,r=this;var l=$('<iframe name="'+a+'" class="xheHideArea" />').appendTo("body");var n=$('<form action="'+t+'" target="'+a+'" method="post" enctype="multipart/form-data" class="xheHideArea"></form>').appendTo("body");var o=$(e),h=o.clone().attr("disabled","true");o.before(h).appendTo(n);this.remove=function(){if(r!==null){h.before(o).remove();l.remove();n.remove();r=null}};this.onLoad=function(){var e=l[0].contentWindow.document,t=$(e.body).text();e.write("");r.remove();i(t,true)};this.start=function(){n.submit();l.load(r.onLoad)};return this};this.html5Upload=function(a,t,i,s,r){var l,n=0,o=t.length,h=0,c=0,d=this;for(var e=0;e<o;e++)c+=t[e].size;this.remove=function(){if(l){l.abort();l=null}};this.uploadNext=function(e){if(e){h+=t[n-1].size;f(0)}if((!e||e&&s(e,n===o)===true)&&n<o)u(t[n++],i,d.uploadNext,function(e){f(e)})};this.start=function(){d.uploadNext()};function u(e,t,i,s){l=new XMLHttpRequest,upload=l.upload;l.onreadystatechange=function(){if(l.readyState===4)i(l.responseText)};if(upload)upload.onprogress=function(e){s(e.loaded)};else s(-1);l.open("POST",t);l.setRequestHeader("Content-Type","application/octet-stream");l.setRequestHeader("Content-Disposition",'attachment; name="'+encodeURIComponent(a)+'"; filename="'+encodeURIComponent(e.name)+'"');if(l.sendAsBinary&&e.getAsBinary)l.sendAsBinary(e.getAsBinary());else l.send(e)}function f(e){if(r)r({loaded:h+e,total:c})}};this.showIframeModal=function(title,url,callback,w,h,onRemove){var jContent=$('<iframe frameborder="0" src="'+url.replace(/{editorRoot}/gi,editorRoot)+(/\?/.test(url)?"&":"?")+"parenthost="+location.host+'" style="width:100%;height:100%;display:none;" /><div class="xheModalIfmWait"></div>'),jIframe=jContent.eq(0),jWait=jContent.eq(1);_this.showModal(title,jContent,w,h,onRemove);var modalWin=jIframe[0].contentWindow,result;initModalWin();jIframe.load(function(){initModalWin();if(result){var bResult=true;try{result=eval("("+unescape(result)+")")}catch(e){bResult=false}if(bResult)return callbackModal(result)}if(jWait.is(":visible")){jIframe.show().focus();jWait.remove()}});function initModalWin(){try{modalWin.callback=callbackModal;modalWin.unloadme=_this.removeModal;$(modalWin.document).keydown(checkEsc);result=modalWin.name}catch(e){}}function callbackModal(e){modalWin.document.write("");_this.removeModal();if(e!=null)callback(e)}};this.showModal=function(e,t,i,s,a){if(bShowModal)return false;_this.panelState=bShowPanel;bShowPanel=false;layerShadow=settings.layerShadow;i=i?i:settings.modalWidth;s=s?s:settings.modalHeight;jModal=$(getLang('<div class="xheModal" style="width:'+(i-1)+"px;height:"+s+"px;margin-left:-"+Math.ceil(i/2)+"px;"+(isIE&&browerVer<7?"":"margin-top:-"+Math.ceil(s/2)+"px")+'">'+(settings.modalTitle?'<div class="xheModalTitle"><span class="xheModalClose" title="{#close} (Esc)" tabindex="0" role="button"></span>'+e+"</div>":"")+'<div class="xheModalContent"></div></div>')).appendTo("body");jOverlay=$('<div class="xheModalOverlay"></div>').appendTo("body");if(layerShadow>0)jModalShadow=$('<div class="xheModalShadow" style="width:'+jModal.outerWidth()+"px;height:"+jModal.outerHeight()+"px;margin-left:-"+(Math.ceil(i/2)-layerShadow-2)+"px;"+(isIE&&browerVer<7?"":"margin-top:-"+(Math.ceil(s/2)-layerShadow-2)+"px")+'"></div>').appendTo("body");$(".xheModalContent",jModal).css("height",s-(settings.modalTitle?$(".xheModalTitle").outerHeight():0)).html(t);if(isIE&&browerVer===6)jHideSelect=$("select:visible").css("visibility","hidden");$(".xheModalClose",jModal).click(_this.removeModal);jOverlay.show();if(layerShadow>0)jModalShadow.show();jModal.show();setTimeout(function(){jModal.find("a,input[type=text],textarea").filter(":visible").filter(function(){return $(this).css("visibility")!=="hidden"}).eq(0).focus()},10);bShowModal=true;onModalRemove=a};this.removeModal=function(){if(jHideSelect)jHideSelect.css("visibility","visible");jModal.html("").remove();if(layerShadow>0)jModalShadow.remove();jOverlay.remove();if(onModalRemove)onModalRemove();bShowModal=false;bShowPanel=_this.panelState};this.showDialog=function(e,t){var i=$('<div class="xheDialog"></div>'),s=$(e),a=$("#xheSave",s);if(a.length===1){s.find("input[type=text],select").keypress(function(e){if(e.which===13){a.click();return false}});s.find("textarea").keydown(function(e){if(e.ctrlKey&&e.which===13){a.click();return false}});a.after(getLang(' <input type="button" id="xheCancel" value="{#dialogCancel}" />'));$("#xheCancel",s).click(_this.hidePanel);if(!settings.clickCancelDialog){bClickCancel=false;var r=$('<div class="xheFixCancel"></div>').appendTo("body").mousedown(returnFalse);var l=_jArea.offset();r.css({left:l.left,top:l.top,width:_jArea.outerWidth(),height:_jArea.outerHeight()})}i.mousedown(function(){bDisableHoverExec=true})}i.append(s);_this.showPanel(i,t)};this.showPanel=function(e,t){if(!ev.target)return false;_jPanel.html("").append(e).css("left",-999).css("top",-999);_jPanelButton=$(ev.target).closest("a").addClass("xheActive");var i=_jPanelButton.offset();var s=i.left,a=i.top;a+=_jPanelButton.outerHeight()-1;_jCntLine.css({left:s+1,top:a,width:_jPanelButton.width()}).show();var r=document.documentElement,l=document.body;if(s+_jPanel.outerWidth()>(window.pageXOffset||r.scrollLeft||l.scrollLeft)+(r.clientWidth||l.clientWidth))s-=_jPanel.outerWidth()-_jPanelButton.outerWidth();var n=settings.layerShadow;if(n>0)_jShadow.css({left:s+n,top:a+n,width:_jPanel.outerWidth(),height:_jPanel.outerHeight()}).show();var o=$("#"+idContainer).offsetParent().css("zIndex");if(o&&!isNaN(o)){_jShadow.css("zIndex",parseInt(o,10)+1);_jPanel.css("zIndex",parseInt(o,10)+2);_jCntLine.css("zIndex",parseInt(o,10)+3)}_jPanel.css({left:s,top:a}).show();if(!t)setTimeout(function(){_jPanel.find("a,input[type=text],textarea").filter(":visible").filter(function(){return $(this).css("visibility")!=="hidden"}).eq(0).focus()},10);bQuickHoverExec=bShowPanel=true};this.hidePanel=function(){if(bShowPanel){_jPanelButton.removeClass("xheActive");_jShadow.hide();_jCntLine.hide();_jPanel.hide();bShowPanel=false;if(!bClickCancel){$(".xheFixCancel").remove();bClickCancel=true}bQuickHoverExec=bDisableHoverExec=false;lastAngle=null;_this.focus();_this.loadBookmark()}};this.exec=function(e){_this.hidePanel();var t=arrTools[e];if(!t)return false;if(ev===null){ev={};var i=_jTools.find(".xheButton[cmd="+e+"]");if(i.length===1)ev.target=i}if(t.e)t.e.call(_this);else{e=e.toLowerCase();switch(e){case"cut":try{_doc.execCommand(e);if(!_doc.queryCommandSupported(e))throw"Error"}catch(e){alert(getLang("cutDisabledTip"))};break;case"copy":try{_doc.execCommand(e);if(!_doc.queryCommandSupported(e))throw"Error"}catch(e){alert(getLang("copyDisabledTip"))}break;case"paste":try{_doc.execCommand(e);if(!_doc.queryCommandSupported(e))throw"Error"}catch(e){alert(getLang("pasteDisabledTip"))}break;case"pastetext":if(window.clipboardData)_this.pasteText(window.clipboardData.getData("Text",true));else _this.showPastetext();break;case"blocktag":var s=[];$.each(settings.listBlocktag,function(e,t){s.push({s:"<"+t.n+">{#listBlocktag."+t.n+"}</"+t.n+">",v:"<"+t.n+">",t:"{#listBlocktag."+t.n+"}"})});_this.showMenu(s,function(e){_this._exec("formatblock",e)});break;case"fontface":var a=[];$.each(getLang("listFontname"),function(e,t){t.c=t.c?t.c:t.n;a.push({s:'<span style="font-family:'+t.c+'">'+t.n+"</span>",v:t.c,t:t.n})});_this.showMenu(a,function(e){_this._exec("fontname",e)});break;case"fontsize":var r=[];$.each(settings.listFontsize,function(e,t){r.push({s:'<span style="font-size:'+t.s+';">{#fontsize.'+t.n+"}("+t.s+")</span>",v:e+1,t:"{#fontsize."+t.n+"}"})});_this.showMenu(r,function(e){_this._exec("fontsize",e)});break;case"fontcolor":_this.showColor(function(e){_this._exec("forecolor",e)});break;case"backcolor":_this.showColor(function(e){if(isIE)_this._exec("backcolor",e);else{setCSS(true);_this._exec("hilitecolor",e);setCSS(false)}});break;case"align":var l=[];$.each(arrAlign,function(e,t){l.push({s:"{#align."+t.v+"}",v:t.v})});_this.showMenu(l,function(e){_this._exec(e)});break;case"list":var n=[];$.each(arrList,function(e,t){n.push({s:"{#list."+t.v+"}",v:t.v})});_this.showMenu(n,function(e){_this._exec(e)});break;case"link":_this.showLink();break;case"anchor":_this.showAnchor();break;case"img":_this.showImg();break;case"flash":_this.showEmbed("Flash",htmlFlash,"application/x-shockwave-flash","clsid:d27cdb6e-ae6d-11cf-96b8-4445535400000",' wmode="opaque" quality="high" menu="false" play="true" loop="true" allowfullscreen="true"',settings.upFlashUrl,settings.upFlashExt);break;case"media":_this.showEmbed("Media",htmlMedia,"application/x-mplayer2","clsid:6bf52a52-394a-11d3-b153-00c04f79faa6",' enablecontextmenu="false" autostart="false"',settings.upMediaUrl,settings.upMediaExt);break;case"hr":_this.pasteHTML("<hr />");break;case"emot":_this.showEmot();break;case"table":_this.showTable();break;case"source":_this.toggleSource();break;case"preview":_this.showPreview();break;case"print":_win.print();break;case"fullscreen":_this.toggleFullscreen();break;case"about":_this.showAbout();break;default:_this._exec(e);break}}ev=null};this._exec=function(e,t,i){if(!i)_this.focus();var s;if(t!==undefined)s=_doc.execCommand(e,false,t);else s=_doc.execCommand(e,false,null);return s};function checkDblClick(e){var t=e.target,i=arrDbClick[t.tagName.toLowerCase()];if(i){if(i==="Embed"){var s={"application/x-shockwave-flash":"Flash","application/x-mplayer2":"Media"};i=s[t.type.toLowerCase()]}_this.exec(i)}}function checkEsc(e){if(e.which===27){if(bShowModal)_this.removeModal();else if(bShowPanel)_this.hidePanel();return false}}function loadReset(){setTimeout(_this.setSource,10)}function saveResult(){_this.getSource()}function cleanPaste(e){var t,i,s;if(e&&(t=e.originalEvent.clipboardData)&&(i=t.items)&&(s=i[0])&&s.kind=="file"&&s.type.match(/^image\//i)){var a=s.getAsFile(),r=new FileReader;r.onload=function(){var e='<img src="'+event.target.result+'">';e=replaceRemoteImg(e);_this.pasteHTML(e)};r.readAsDataURL(a);return false}var l=settings.cleanPaste;if(l===0||bSource||bCleanPaste)return true;bCleanPaste=true;_this.saveBookmark();var n=isIE?"pre":"div",o=$("<"+n+' class="xhe-paste">\ufeff\ufeff</'+n+">",_doc).appendTo(_doc.body),h=o[0],c=_this.getSel(),d=_this.getRng(true);o.css("top",_jWin.scrollTop());if(isIE||isIE11){d.moveToElementText(h);d.select()}else{d.selectNodeContents(h);c.removeAllRanges();c.addRange(d)}setTimeout(function(){var e=l===3,t;if(e){o.html(o.html().replace(/<br(\s+[^<>]*)?>/gi,"\n"));t=o.text()}else{var i=$(".xhe-paste",_doc.body),s=[];i.each(function(e,t){if($(t).find(".xhe-paste").length==0)s.push(t.innerHTML)});t=s.join("<br />")}o.remove();_this.loadBookmark();t=t.replace(/^[\s\uFEFF]+|[\s\uFEFF]+$/g,"");if(t){if(e)_this.pasteText(t);else{t=_this.cleanHTML(t);t=_this.cleanWord(t);t=_this.formatXHTML(t);if(!settings.onPaste||settings.onPaste&&(t=settings.onPaste(t))!==false){t=replaceRemoteImg(t);_this.pasteHTML(t)}}}bCleanPaste=false},0)}function replaceRemoteImg(e){var r=settings.localUrlTest,t=settings.remoteImgSaveUrl;if(r&&t){var l=[],n=0;e=e.replace(/(<img)((?:\s+[^>]*?)?(?:\s+src="\s*([^"]+)\s*")(?: [^>]*)?)(\/?>)/gi,function(e,t,i,s,a){if(/^(https?|data:image)/i.test(s)&&!/_xhe_temp/.test(i)&&!r.test(s)){l[n]=s;i=i.replace(/\s+(width|height)="[^"]*"/gi,"").replace(/\s+src="[^"]*"/gi,' src="'+skinPath+'img/waiting.gif" remoteimg="'+n+++'"')}return t+i+a});if(l.length>0){$.post(t,{urls:l.join("|")},function(t){t=t.split("|");$("img[remoteimg]",_this.doc).each(function(){var e=$(this);xheAttr(e,"src",t[e.attr("remoteimg")]);e.removeAttr("remoteimg")})})}}return e}function setCSS(t){try{_this._exec("styleWithCSS",t,true)}catch(e){try{_this._exec("useCSS",!t,true)}catch(e){}}}function setOpts(){if(bInit&&!bSource){setCSS(false);try{_this._exec("enableObjectResizing",true,true)}catch(e){}if(isIE)try{_this._exec("BackgroundImageCache",true,true)}catch(e){}}}function forcePtag(e){if(bSource||e.which!==13||e.shiftKey||e.ctrlKey||e.altKey)return true;var t=_this.getParent("p,h1,h2,h3,h4,h5,h6,pre,address,div,li");if(t.is("li"))return true;if(settings.forcePtag){if(t.length===0)_this._exec("formatblock","<p>")}else{_this.pasteHTML("<br />");if(isIE&&t.length>0&&_this.getRng().parentElement().childNodes.length===2)_this.pasteHTML("<br />");return false}}function fixFullHeight(){if(!isMozilla&&!isWebkit){if(bFullscreen)_jArea.height("100%").css("height",_jArea.outerHeight()-_jTools.outerHeight());if(isIE)_jTools.hide().show()}}function fixAppleSel(e){e=e.target;if(e.tagName.match(/(img|embed)/i)){var t=_this.getSel(),i=_this.getRng(true);i.selectNode(e);t.removeAllRanges();t.addRange(i)}}function xheAttr(e,t,i){if(!t)return false;var s="_xhe_"+t;if(i){if(urlType)i=getLocalUrl(i,urlType,urlBase);e.attr(t,urlBase?getLocalUrl(i,"abs",urlBase):i).removeAttr(s).attr(s,i)}return e.attr(s)||e.attr(t)}function clickCancelPanel(){if(bClickCancel)_this.hidePanel()}function checkShortcuts(e){if(bSource)return true;var t=e.which,i=specialKeys[t],s=i?i:String.fromCharCode(t).toLowerCase();sKey="";sKey+=e.ctrlKey?"ctrl+":"";sKey+=e.altKey?"alt+":"";sKey+=e.shiftKey?"shift+":"";sKey+=s;var a=arrShortCuts[sKey],r;for(r in a){r=a[r];if($.isFunction(r)){if(r.call(_this)===false)return false}else{_this.exec(r);return false}}}function is(e,t){var i=typeof e;if(!t)return i!="undefined";if(t==="array"&&(e.hasOwnProperty&&e instanceof Array))return true;return i===t}function getLocalUrl(e,t,i){if(e.match(/^(\w+):\/\//i)&&!e.match(/^https?:/i)||/^#/i.test(e)||/^data:/i.test(e))return e;var s=i?$('<a href="'+i+'" />')[0]:location,a=s.protocol,r=s.host,l=s.hostname,n=s.port,o=s.pathname.replace(/\\/g,"/").replace(/[^\/]+$/i,"");if(n==="")n="80";if(o==="")o="/";else if(o.charAt(0)!=="/")o="/"+o;e=$.trim(e);if(t!=="abs")e=e.replace(new RegExp(a+"\\/\\/"+l.replace(/\./g,"\\.")+"(?::"+n+")"+(n==="80"?"?":"")+"(/|$)","i"),"/");if(t==="rel")e=e.replace(new RegExp("^"+o.replace(/([\/\.\+\[\]\(\)])/g,"\\$1"),"i"),"");if(t!=="rel"){if(!e.match(/^(https?:\/\/|\/)/i))e=o+e;if(e.charAt(0)==="/"){var h=[],c=e.split("/"),d,u,f=c.length;for(u=0;u<f;u++){d=c[u];if(d==="..")h.pop();else if(d!==""&&d!==".")h.push(d)}if(c[f-1]==="")h.push("");e="/"+h.join("/")}}if(t==="abs"&&!e.match(/^https?:\/\//i))e=a+"//"+r+e;e=e.replace(/(https?:\/\/[^:\/?#]+):80(\/|$)/i,"$1$2");return e}function checkFileExt(e,t){if(t==="*"||e.match(new RegExp(".("+t.replace(/,/g,"|")+")$","i")))return true;else{alert(getLang("upload.extLimit",t));return false}}function formatBytes(e){var t=["Byte","KB","MB","GB","TB","PB"];var i=Math.floor(Math.log(e)/Math.log(1024));return(e/Math.pow(1024,Math.floor(i))).toFixed(2)+t[i]}function returnFalse(){return false}};XHEDITOR.settings={skin:"default",tools:"full",delBtns:"",clickCancelDialog:true,linkTag:false,internalScript:false,inlineScript:false,internalStyle:true,inlineStyle:true,showBlocktag:false,forcePtag:true,upLinkExt:"zip,rar,txt",upImgExt:"jpg,jpeg,gif,png",upFlashExt:"swf",upMediaExt:"wmv,avi,wma,mp3,mid",modalWidth:350,modalHeight:220,modalTitle:true,defLinkText:"{#link.defText}",layerShadow:3,emotMark:false,upBtnText:"{#upload.btnText}",cleanPaste:1,hoverExecDelay:100,html5Upload:true,upMultiple:99,listBlocktag:[{n:"p"},{n:"h1"},{n:"h2"},{n:"h3"},{n:"h4"},{n:"h5"},{n:"h6"},{n:"pre"},{n:"address"}],listColors:["#FFFFFF","#CCCCCC","#C0C0C0","#999999","#666666","#333333","#000000","#FFCCCC","#FF6666","#FF0000","#CC0000","#990000","#660000","#330000","#FFCC99","#FF9966","#FF9900","#FF6600","#CC6600","#993300","#663300","#FFFF99","#FFFF66","#FFCC66","#FFCC33","#CC9933","#996633","#663333","#FFFFCC","#FFFF33","#FFFF00","#FFCC00","#999900","#666600","#333300","#99FF99","#66FF99","#33FF33","#33CC00","#009900","#006600","#003300","#99FFFF","#33FFFF","#66CCCC","#00CCCC","#339999","#336666","#003333","#CCFFFF","#66FFFF","#33CCFF","#3366FF","#3333FF","#000099","#000066","#CCCCFF","#9999FF","#6666CC","#6633FF","#6600CC","#333399","#330099","#FFCCFF","#FF99FF","#CC66CC","#CC33CC","#993399","#663366","#330033"],listFontsize:[{n:"x-small",s:"10px"},{n:"small",s:"12px"},{n:"medium",s:"16px"},{n:"large",s:"18px"},{n:"x-large",s:"24px"},{n:"xx-large",s:"32px"},{n:"-webkit-xxx-large",s:"48px"}]};$.fn.xheditor=function(options){var editTest=document.body.contentEditable?document.body.contentEditable:document.designMode;if(!editTest){return false}var arrSuccess=[];this.each(function(){if(!$.nodeName(this,"TEXTAREA"))return;if(options===false){if(this.xheditor){this.xheditor.remove();this.xheditor=null}}else{if(!this.xheditor){var tOptions=/({.*})/.exec($(this).attr("class"));if(tOptions){try{tOptions=eval("("+tOptions[1]+")")}catch(e){}options=$.extend({},tOptions,options)}var editor=new Xheditor(this,options);if(editor.init()){this.xheditor=editor;arrSuccess.push(editor)}else editor=null}else arrSuccess.push(this.xheditor)}});if(arrSuccess.length===0)arrSuccess=false;if(arrSuccess.length===1)arrSuccess=arrSuccess[0];return arrSuccess};$.fn.oldVal=$.fn.val;$.fn.val=function(e){var t=this,i;if(e===undefined)if(t[0]&&(i=t[0].xheditor))return i.getSource();else return t.oldVal();return t.each(function(){if(i=this.xheditor)i.setSource(e);else t.oldVal(e)})};$(function(){$("textarea").each(function(){var e=$(this),t=e.attr("class");if(t&&(t=t.match(/(?:^|\s)xheditor(?:\-(m?full|simple|mini))?(?:\s|$)/i)))e.xheditor(t[1]?{tools:t[1]}:null)})})})(XHEDITOR,jQuery);